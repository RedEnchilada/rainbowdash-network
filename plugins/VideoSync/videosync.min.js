Videosync={yt_id:null,started:null,player:null,height:390,width:640,active:false,cookie:"VideoSyncState",tolerance:2,videoFrame:"videosync_box",trigger:"videosync_btn",syncChannel:null,oldFeedHandler:null,oldAPIHandler:null,init:function(b){var a=Videosync;if(b){a.yt_id=b.yt_id;a.started=b.started;a.syncChannel=b.channel}if(typeof YT=="undefined"){a.loadApi();return}a.active=a.getCookie();$("#"+a.trigger).click(a.clickButton);$(a.toggleFrame)},initPlayer:function(){V=Videosync;V.player=new YT.Player(V.videoFrame,{height:V.height,width:V.width,videoId:V.yt_id,events:{onReady:function(){V.updatePlayer(V.yt_id,new Date().getTime()/1000-V.started)},},})},getCookie:function(){if($.cookie(Videosync.cookie)){return true}else{return false}},toggleCookie:function(){var a=Videosync;if($.cookie(a.cookie)){a.active=false;$.cookie(a.cookie,null,{expires:1,path:"/"})}else{a.active=true;$.cookie(a.cookie,"true",{expires:1,path:"/"})}},updatePlayer:function(b,c){var a=Videosync;a.yt_id=b;if(typeof a.player.getCurrentTime!="undefined"){if(b!=a.yt_id){a.player.loadVideoById(a.yt_id,c,"large")}else{if(Math.abs(a.player.getCurrentTime()-c)>a.tolerance){a.player.seekTo(c)}}}},clickButton:function(){var a=Videosync;a.toggleCookie();a.toggleFrame()},loadApi:function(){$.getScript("//www.youtube.com/iframe_api")},toggleFrame:function(){var a=Videosync;if(a.active){$("#"+a.trigger).val("\u25B2 Hide live stream \u25B2");a.initPlayer();a.setupFeed();$("#"+a.videoFrame).show()}else{$("#"+a.trigger).val("\u25BC Watch our live stream! \u25BC");$("#"+a.videoFrame).replaceWith('<div id="'+a.videoFrame+'"></div>');a.player=null;a.removeFeed();$("#"+a.videoFrame).hide()}},setupFeed:function(){var a=Videosync;a.oldFeedHandler=Meteor.callbacks.process;Meteor.callbacks.process=function(b){a.handleFeed(b)};Meteor.joinChannel(a.syncChannel,0)},handleFeed:function(b){var a=Videosync;jdata=JSON.parse(b);if(typeof b.yt_id=="undefined"){a.updatePlayer(jdata.yt_id,jdata.pos)}else{a.oldFeedHandler(b)}},removeFeed:function(){var a=Videosync;Meteor.leaveChannel(a.syncChannel);Meteor.callbacks.process=a.oldFeedHandler;a.oldFeedHandler=null},};if(typeof onYouTubeIframeAPIReady!="undefined"){Videosync.oldAPIHandler=onYouTubeIframeAPIReady}onYouTubeIframeAPIReady=function(){Videosync.init();if(Videosync.oldAPIHandler){Videosync.oldAPIHandler()}};